#!/usr/bin/env bash
set -uo pipefail

SCRIPTS_DIR=$(dirname $0)

echo 'Checking for Expo App...'
$SCRIPTS_DIR/download-expo.sh

echo 'Fetching App Bundle from Expo Packager...'
# warm up the app - prebuild the bundle with dev=false and minify=true, otherwise it times out at start of detox test
rep=$(curl -fs "http://127.0.0.1:19000/node_modules/expo/AppEntry.bundle?platform=ios&dev=false&hot=false&minify=true")
status=$?

if [ "$status" -ne 0 ]; then
    echo ''
    echo '****************************************************************************************'
    echo '*  Fetching App Bundle failed - did you start the packager with `npm run start:e2e` ?  *'
    echo '****************************************************************************************'
    exit 1
else
    echo 'Fetched App Bundle from Expo Packager'
fi
